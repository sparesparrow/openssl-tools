name: PR Validation

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read

jobs:
  fast-validation:
    name: Fast Validation (3-5 min)
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          
      - name: Install dependencies
        run: |
          pip install conan>=2.0
          conan --version
          
      - name: Validate conanfile.py
        run: |
          echo "üîç Validating conanfile.py..."
          python3 -c "
          import sys
          sys.path.insert(0, '.')
          try:
              from conanfile import OpenSSLToolsConan
              print('‚úÖ conanfile.py imports successfully')
          except Exception as e:
              print(f'‚ùå conanfile.py validation failed: {e}')
              sys.exit(1)
          "
          
      - name: Test Python imports
        run: |
          echo "üêç Testing Python imports..."
          python3 -c "
          import sys
          sys.path.insert(0, '.')
          try:
              import openssl_tools
              print('‚úÖ openssl_tools imports successfully')
          except ImportError as e:
              print(f'‚ùå openssl_tools import failed: {e}')
              sys.exit(1)
          "
          
      - name: Validate scripts structure
        run: |
          echo "üìÅ Validating scripts structure..."
          if [ -d "scripts" ]; then
            echo "‚úÖ scripts directory exists"
            ls -la scripts/ | head -5
          else
            echo "‚ùå scripts directory missing"
            exit 1
          fi
          
      - name: Test Conan configuration
        run: |
          echo "üîß Testing Conan configuration..."
          conan profile detect --force
          conan config init
          conan profile show default
          
      - name: Report validation status
        if: always()
        run: |
          if [ "${{ job.status }}" == "success" ]; then
            echo "‚úÖ PR validation passed"
          else
            echo "‚ùå PR validation failed"
          fi
