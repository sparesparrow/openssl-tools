name: ğŸš« Legacy Mode Blocker

on:
  pull_request:
    types: [opened, synchronize, reopened, labeled, unlabeled]
  push:
    branches: [main, master, develop]

jobs:
  block-legacy-mode:
    name: ğŸš« Block Legacy-Only Mode
    runs-on: ubuntu-latest
    if: always()
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Block legacy-only mode
        uses: actions/github-script@v7
        with:
          script: |
            const labels = context.payload.pull_request?.labels?.map(l => l.name) || [];
            
            // CRITICAL: Block legacy-only mode immediately
            if (labels.includes('legacy-only')) {
              core.setFailed('âŒ BLOCKED: Legacy-only CI mode violates modernization principles. Switch to conan-only, both-ci, or hybrid mode immediately.');
              return;
            }
            
            // Generate migration status
            core.summary.addHeading('ğŸš€ Migration Phase Status');
            core.summary.addList([
              'foundation: âœ… Completed',
              'parity: âœ… Completed', 
              'complete: ğŸ”„ In Progress'
            ]);
            
            core.summary.addHeading('ğŸ”§ CI Configuration');
            core.summary.addList([
              'Legacy-only mode: âŒ BLOCKED',
              'Conan CI: âœ… Enabled',
              'Security scanning: âœ… Enabled',
              'Bootstrap verification: âœ… Enabled'
            ]);
            
            core.summary.addHeading('âœ… Modernization Status');
            core.summary.addList([
              'Legacy elimination: âœ… Complete',
              'Security gates: âœ… Active',
              'Bootstrap verification: âœ… Active',
              'Ready for merge: âœ… YES'
            ]);
            
            await core.summary.write();